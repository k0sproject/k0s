/*
Copyright 2022 k0s authors

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
package v1beta1

import (
	"testing"

	"github.com/stretchr/testify/suite"
)

type runtimeSuite struct {
	suite.Suite
}

func (r *runtimeSuite) TestValidation() {
	var validRuntimeSpecs = []struct {
		desc string
		spec *RuntimeSpec
	}{
		{
			desc: "default_runtime_spec_is_valid",
			spec: DefaultRuntimeSpec(),
		},
		{
			desc: "valid_runtime_spec_is_valid",
			spec: &RuntimeSpec{
				Registries: []*RegistryConfig{
					{
						Name:         "registry1:443",
						Capabilities: []string{"pull", "resolve"},
						SkipVerify:   true,
						Server:       "https://registry1",
						CACert:       "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM5ekNDQWQrZ0F3SUJBZ0lKQU5oVmFPMmtxK3htTUEwR0NTcUdTSWIzRFFFQkN3VUFNQkl4RURBT0JnTlYKQkFNTUIzUmxjM1F0WTJFd0hoY05Nakl3TWpBNE1USXlNak0yV2hjTk1qSXdOREE1TVRJeU1qTTJXakFTTVJBdwpEZ1lEVlFRRERBZDBaWE4wTFdOaE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCjVaU3IzR0QvRmRhZEdnakZwNjBPbG51M0NsQ1FQM1BPeXVXWVJuTVF4SHZTRUdiRkpkcTJhNXFuWFdqNzJ0OWEKaHhmRHdkdWk5RHdOd3ZGSUhrZ2thdU1WbjZOQWNiSzFMUlNVYk10RnYzSUY5cUZDZ3p1UnNtUGpmQjdKM2U1egpucXRsd2YyR2MwY3djb081S0JLZ09JSFRNZ1dOTkw5dzl3RGtSWjUyVGtVR1o4MG8wN2wzQjhaQTV0MkJoS2RNClpTY2VianFXNEJkQk54eWMyeEpjZzQ2MnF4QnB2S3Z6NmR3dThQQjNHNEgzTlM1MDBFRGZYVXBVWElBT2NlYlkKeFoyMmxLODJnN21zSFRzL0RYQW0rNk04Qzl5VVhodGFNYnBacWM3WFErTGZacStRd0hXRit6VVRLQ2VCWUd2RwpmTmdGa2JYK0V2V2tOWXV2eFNxQnhRSURBUUFCbzFBd1RqQWRCZ05WSFE0RUZnUVVjVEwyQzR1Rks0VGJhb1pVCnpVa0ZzZ0hveHJrd0h3WURWUjBqQkJnd0ZvQVVjVEwyQzR1Rks0VGJhb1pVelVrRnNnSG94cmt3REFZRFZSMFQKQkFVd0F3RUIvekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBa3J1ODVNMTlSYTRBSU9HbmttZUk3ZFBsOU5VMgpUYTNiaVFLN0J6WU9qZ2VZUXVxbnpvaHBEM0t4QzFBdEdCZG5SeWtvRUwzWVlxM0liZXB3Zy9MeUpWczNNUDJXCm8rMGZGRFo2RWFNRzNNNEd1SFdzb0tvbHZuRXJkY2QrUnU1VGFoU2J3RjN1Yys0TFh2ZGliOWNXa01nZFQ2VWgKMExKWHJaTVA1K1QwM3RWdldreldmR2NUZXh4NlgrQmYxUnFrRm1BWmhuNUI0RjZlQ2liVW1ON0RMSlQ3QUlTSgptWWFsNWJ3K1IyYzZEUEZaK3FBQUlES0FXSDFCU2VTT2lEWTM3aStCNStsZW8yYVNCMTdDb0UvWUpWaWF4Z1BCCjVlcEZrcU9vV3IwbWx6MzVSZXZPU1A0cWJXSTBHMnRPR3orcmlVUWlMMXhXOFFMOVUxUTUyU29FRFE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t",
						ClientCert:   "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURBekNDQWV1Z0F3SUJBZ0lKQUxseVU3RFEvVzZCTUEwR0NTcUdTSWIzRFFFQkN3VUFNQkl4RURBT0JnTlYKQkFNTUIzUmxjM1F0WTJFd0hoY05Nakl3TWpBNE1USXlNalV6V2hjTk1qSXdOREE1TVRJeU1qVXpXakFVTVJJdwpFQVlEVlFRRERBbHlaV2RwYzNSeWVURXdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCCkFRRENCdVJkc211YzBXU2NpVWVRM2F6YWJsYXVzNHZQQzVmWFJMZVduV3gxLzl2VHJJRU1YeGZBbGVQU2JQc0UKQU1BbVlZOEV2ajcvOXFjd0JEU2czU2c4eGIzNFBRWmZHU0Y0RHluR0VQN1BvTjZTVWJQc2c1aHdxSXA0RFhhOQovL0JEcVpuVDlGNExpZk01NDhPZmZDQ2ZrSXk4OGhaN01BcjhrcWtId0lGcDVhZ2ttN3A0WkZRL290L1dqWGxQCnZUSW13OGdLVVpvTHBPa3pBUEJsSURkekVvYmMxZkM5Q0I2TWduT0h0OFcwVXo3amxoVFkweHVnUXN2S2JrbVQKbGl6VTdlcnM0VXozL0JwMVdXcklCTTdNMjRjV0N4cWRIbGJBQ0FaYTB1ditoUmRiYURibHg0QWpRUkptMmRFRQpISERJMGtGeWxrMktxUVV6ajV3WVlIOHBBZ01CQUFHaldqQllNQWtHQTFVZEV3UUNNQUF3Q3dZRFZSMFBCQVFECkFnWGdNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQVRBZkJnTlZIUkVFR0RBV2dnbHkKWldkcGMzUnllVEdDQ1hKbFoybHpkSEo1TVRBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQXU5R3RSaTFoSnpSbQpDUWFMQkw5dklWNTd1TDBJcXpHUTNpZDhHVXdyQ0h2bEZUbUc2QWFTRmlQRmRRT09OWWV5NWRoZURjZEtnbEI4Ckt1dllqOVJ0YXNZZmM1dlBPM0ErY0Y5UzdiSUNGaUZHM1BEZFdrLyt0ZjdhZFZXdWNSR0wzQ2JaU24vK1Y0N3oKNXIxbkVkMzF5cHhEM0swZUhLZTBwMDNtaE1nK2ZWR3A1TXlzdzFYdUh3K01EZmpjUzladk5XdkdTVFkzaGx0UQorcTFZTlJ6Wm1LaEltQkxmU0MxbWRQdnFQbk5RWnEzNmJtZG5lS0E0OEQ2S2JLRC9pT1dyempTMzllTFZwVGFBClA1ZHd0R2dUSVFsaTltYS8rSUFmQTI4Sk9NYXdGZUlzSU84N1doWkNwYjNaY2JITmxTV0VLNWxWeUpSeEVuYlYKSjc2OGxIZ2tCZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=",
						ClientKey:    "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBd2dia1hiSnJuTkZrbklsSGtOMnMybTVXcnJPTHp3dVgxMFMzbHAxc2RmL2IwNnlCCkRGOFh3SlhqMG16N0JBREFKbUdQQkw0Ky8vYW5NQVEwb04wb1BNVzkrRDBHWHhraGVBOHB4aEQrejZEZWtsR3oKN0lPWWNLaUtlQTEydmYvd1E2bVowL1JlQzRuek9lUERuM3dnbjVDTXZQSVdlekFLL0pLcEI4Q0JhZVdvSkp1NgplR1JVUDZMZjFvMTVUNzB5SnNQSUNsR2FDNlRwTXdEd1pTQTNjeEtHM05Yd3ZRZ2VqSUp6aDdmRnRGTSs0NVlVCjJOTWJvRUxMeW01Sms1WXMxTzNxN09GTTkvd2FkVmxxeUFUT3pOdUhGZ3NhblI1V3dBZ0dXdExyL29VWFcyZzIKNWNlQUkwRVNadG5SQkJ4d3lOSkJjcFpOaXFrRk00K2NHR0IvS1FJREFRQUJBb0lCQVFDbExSamNhemdSbUhEKwpraC9Ldyt5VFI3dWpubFkzUExkWEc3anZEN1YxL3dzMWVIV2tBcEJGODFTdm52ZFN3UkRUbTlvVlA2Q0NaNGlNCjZBZWxxcURHbTlETnM2WG83NHYrbVdvR3BCRkkwTHFwOWNRbVpTRXhSMG9hU2R2OGhCWVdoQnZneFBnSytyV0YKWXREMnhNVkJFZDIrUEpuRzVXOTA5YVhRWTZISWM2NDFOeTQrSk0xQVdSVWxqcG1sSGJGVnl4R25xYmNpTk41QQpFYzVuYzhaRWdNd1h3UzhjeXN0ZXI2cHQvOVNteCtKK2REZEoyQjVmN204TGhucW9JQW1zUTJ4NGE2YXVKeHBPCnU3RmFqVWRhYnhJVXJ6TmZKQUUzZjRBMWhRT1hjMlhKd1Q5Z2Jva3B2YU5kVFBHaW0yUXY0TXQ3ekZlSXF4NVYKc2lmVW0zY0JBb0dCQU96ZjBTY2haVUJuRUZqQ2podVJqQWNXR3hTckdPMFFFOElKYVltYjd2dVcwM3FBZDdBSwp3TXFOckl5UW5ZaEJZbHJzY2t5Q3JBb24welNVRVdZblhiYmJJV2R1MUhoYy9rbVdNVUdBemRrU1hoQlh0dHg2CmFyY09IQm5JTGdPWWxQYWo5U3ZjbWx0ZEY4cUFkcDhXOVJOeHZRVVF1b0VJTFZCZ0o2dFlxM2t0QW9HQkFOR3gKYSsxU3BxSUhQRkFGejZaVmQ4T3VGQkxNdElpRGpRb2tBdlpZSDFTMTBVb1FaVVRqNzN4VW01R0ZNQnNQWjhmMwpDUnM3U1FXZEZid1lQTFE1RXdLNjkrK0JkcUJjcS8zKzJFamtRYjVEckp6VU0zWmhKUG5MNkVxWVdMdnNzbVhqCkdXOHF2S0NEd3l4UnBXdTAyNUdQY1hlU0lVN2Zha1pVNktZemQrTnRBb0dBSmFBZnJ1R0ZIY2ZCTnZnZ2JveWQKKzNvdGJ3a0dlcEYxTWZzZ3duVDhid1kwTFY4K283M3hoYnNmVDJ5aE9VVjVoQXZPMUF4bG0yOWNBeHdKNzNvTgpUc0JiKy93RXorR2xtcmE2dURibmU3V0pMM3RmVm9JemRVUk9mbUhudlRaOVl2Z0VONlZnOTJaQUl6Qm9wemlVClVUUmQyL0llVGVTb25mM0lEMVdVVnprQ2dZQUdqTE1oUzRhVzR3RDRRdVkwZk5EcjFNRWR3VFVXV24yS1JvdXQKSkIxK2FOdHJvODExOUdTampvVDVhNTZRQ2RBbEI4dEtCWFVIYnR1aDcyUGVBVFpkekhjNERPUW1xQjViSloyZAowVHRZZFFhc00xaVVKdjZmcXNYTHBxeUcyaUxNV2VhT2VWaEE3enltWXJwMi9jUXA3TUFQaXdudFM3OG5DVG5uCkR3NThsUUtCZ0gvaFhKMWEvM056aHo1NWFEOEJqMVBTZGNWWVU4d3VlSUs5QlU5U003elovc0Vrc3R3UlM3U1kKSUQxeWtTYkU0cklVSDRDZDNpWHFkeVJIWmxTM2NQNElmOElDbFFob1BuUHJBTW44WE9pcXBsRHkvVThTOXdnMwpDOHJKV05tM0U2YnBFRnRhaHVkYWlYcGNHSzZwOE9FQ0V4MHFvdzFxN2VJWGc5MXMrdTIrCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0t",
					},
					{
						Name:         "registry2:443",
						Capabilities: []string{"pull", "resolve"},
						SkipVerify:   true,
						Server:       "https://registry2",
						CACert:       "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM5ekNDQWQrZ0F3SUJBZ0lKQU5oVmFPMmtxK3htTUEwR0NTcUdTSWIzRFFFQkN3VUFNQkl4RURBT0JnTlYKQkFNTUIzUmxjM1F0WTJFd0hoY05Nakl3TWpBNE1USXlNak0yV2hjTk1qSXdOREE1TVRJeU1qTTJXakFTTVJBdwpEZ1lEVlFRRERBZDBaWE4wTFdOaE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCjVaU3IzR0QvRmRhZEdnakZwNjBPbG51M0NsQ1FQM1BPeXVXWVJuTVF4SHZTRUdiRkpkcTJhNXFuWFdqNzJ0OWEKaHhmRHdkdWk5RHdOd3ZGSUhrZ2thdU1WbjZOQWNiSzFMUlNVYk10RnYzSUY5cUZDZ3p1UnNtUGpmQjdKM2U1egpucXRsd2YyR2MwY3djb081S0JLZ09JSFRNZ1dOTkw5dzl3RGtSWjUyVGtVR1o4MG8wN2wzQjhaQTV0MkJoS2RNClpTY2VianFXNEJkQk54eWMyeEpjZzQ2MnF4QnB2S3Z6NmR3dThQQjNHNEgzTlM1MDBFRGZYVXBVWElBT2NlYlkKeFoyMmxLODJnN21zSFRzL0RYQW0rNk04Qzl5VVhodGFNYnBacWM3WFErTGZacStRd0hXRit6VVRLQ2VCWUd2RwpmTmdGa2JYK0V2V2tOWXV2eFNxQnhRSURBUUFCbzFBd1RqQWRCZ05WSFE0RUZnUVVjVEwyQzR1Rks0VGJhb1pVCnpVa0ZzZ0hveHJrd0h3WURWUjBqQkJnd0ZvQVVjVEwyQzR1Rks0VGJhb1pVelVrRnNnSG94cmt3REFZRFZSMFQKQkFVd0F3RUIvekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBa3J1ODVNMTlSYTRBSU9HbmttZUk3ZFBsOU5VMgpUYTNiaVFLN0J6WU9qZ2VZUXVxbnpvaHBEM0t4QzFBdEdCZG5SeWtvRUwzWVlxM0liZXB3Zy9MeUpWczNNUDJXCm8rMGZGRFo2RWFNRzNNNEd1SFdzb0tvbHZuRXJkY2QrUnU1VGFoU2J3RjN1Yys0TFh2ZGliOWNXa01nZFQ2VWgKMExKWHJaTVA1K1QwM3RWdldreldmR2NUZXh4NlgrQmYxUnFrRm1BWmhuNUI0RjZlQ2liVW1ON0RMSlQ3QUlTSgptWWFsNWJ3K1IyYzZEUEZaK3FBQUlES0FXSDFCU2VTT2lEWTM3aStCNStsZW8yYVNCMTdDb0UvWUpWaWF4Z1BCCjVlcEZrcU9vV3IwbWx6MzVSZXZPU1A0cWJXSTBHMnRPR3orcmlVUWlMMXhXOFFMOVUxUTUyU29FRFE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==",
						ClientCert:   "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURBekNDQWV1Z0F3SUJBZ0lKQUxseVU3RFEvVzZDTUEwR0NTcUdTSWIzRFFFQkN3VUFNQkl4RURBT0JnTlYKQkFNTUIzUmxjM1F0WTJFd0hoY05Nakl3TWpBNE1USXlNalV6V2hjTk1qSXdOREE1TVRJeU1qVXpXakFVTVJJdwpFQVlEVlFRRERBbHlaV2RwYzNSeWVUSXdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCCkFRRGJDT3Ewa3JzdGs2cmIvR093SmU4cG1LWVI5NnplVXJKalQ0cFZ3UkdWQzVydmZoSzY4T1AxTWdaQTErd2cKS0wrNFVyMWlha1FRcml2bkpSbHJQZzFvVUlWaVJqdFR0anU0MzFFYy9GWXY4d2IzN2lsWkhWdjJUZDJvRityUwp3NU5laThWR1hMRWYrdzJQamhoU3lrNmpkcTNPQU45WHdQVzdVTUJrU1FpL3QyM0kvbkhrWmxDYTQ3QWRmVnBaCjhUckFBR1FmN3dFNzk3bGxPTHhLb0pObkZ5Y3dTWmJ1YnVGejU0SnFQcnB4RFE0dU1aZ1RtYmlqZlJseUk5dXEKTi9LZFNnR255NEZWRjNEMTI2QnV1RTNFQmc1ZkphemVTNnZ1ZDh3NTFLQVpmR0JIRUJMUmRpNWJ6bmRJR1dFTgpPQStTVG9GQVNMZ1VmTHpmYzlmNUdBUlhBZ01CQUFHaldqQllNQWtHQTFVZEV3UUNNQUF3Q3dZRFZSMFBCQVFECkFnWGdNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQVRBZkJnTlZIUkVFR0RBV2dnbHkKWldkcGMzUnllVEtDQ1hKbFoybHpkSEo1TWpBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQWRjbndjNmU2MzJRcQpBKzBmbmg1am1rNE1JTkM4aWpzQlcwS2NuNzZ0WHV5NUtQc0Q5NUphQlRhemFqbllEd0IvNEhmQUFjcGdYNys5CnQwUklITFBpd1IxdGxySG92QUw3cFlEQlpDU3QvYjZDNW13ZUd3Nm5zejJlcXFlMUtHRVJRMmpyR3VJRFJRREYKNnJlMVY5elpWa3h2QzM5YjhSRWd4OW1uZW9DWnhJZUZtMGNQMFJNVGVmS1BTbjFNSG1nRDNhQ0Voc0k5UzRpMwprVkUwbWlLeThuQ2VzUTBDL21tV01CbktUakZmSzFzNDVpd3FmY2dpbVNKZ3FCVXlpUjlud05kZ0FqNUdxV2c3CitqQ3V2azhqWGh5T2JlemZWTmNoc1crSis2ZTh4NEc1ekU4eVNYb3YyamhnQWxERG1peTRLUHIxRktub2RyaXgKTDYza0VTTDIrdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K",
						ClientKey:    "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMndqcXRKSzdMWk9xMi94anNDWHZLWmltRWZlczNsS3lZMCtLVmNFUmxRdWE3MzRTCnV2RGo5VElHUU5mc0lDaS91Rks5WW1wRUVLNHI1eVVaYXo0TmFGQ0ZZa1k3VTdZN3VOOVJIUHhXTC9NRzkrNHAKV1IxYjlrM2RxQmZxMHNPVFhvdkZSbHl4SC9zTmo0NFlVc3BPbzNhdHpnRGZWOEQxdTFEQVpFa0l2N2R0eVA1eAo1R1pRbXVPd0hYMWFXZkU2d0FCa0grOEJPL2U1WlRpOFNxQ1RaeGNuTUVtVzdtN2hjK2VDYWo2NmNRME9MakdZCkU1bTRvMzBaY2lQYnFqZnluVW9CcDh1QlZSZHc5ZHVnYnJoTnhBWU9YeVdzM2t1cjduZk1PZFNnR1h4Z1J4QVMKMFhZdVc4NTNTQmxoRFRnUGtrNkJRRWk0Rkh5ODMzUFgrUmdFVndJREFRQUJBb0lCQUR5WXUrNFhCZ2UyNmJjUQpuVGUzVnZJb0ZCRzJkckhQS1NFR2VWditIUElpRXN3ZEVldDhCMlRuWVFtQmN3YjJud3ZNZ0M2QS9iR3JyZU8xCnhOR0JpazRJc000ZVpmMWoxaVB3VEUxN2xoQ1A2S2FnMGZtZ2dMZWtsU1VTOE5rOFdFSDQ0eXZ6S3VHUklCQk8KSEhhVEY2eHJnZXdURzdiNFlFTmhOTWpKMTh6SjNFczFwYnZnQkl6WEp0Nzd1UmpERUZ5cm56R1ZwQURJOU9Rawp0aEpGWHF5YW0zbmRVOHNiekp6THVRZnFHWmQ1OHNrOFQwRlgwV1pYQ29aeS9UenU2aTZyakhJcXZuN2owWHcvCjRPWEdCWUpaOTJqVXFUWUxvRURQU0RxZTN5NTMxWkZ6TGtkSWRjMjBGQ3JyOHZrUXZKY1FSQjgzL09TSFdFeGsKR2RadGhZa0NnWUVBOWpLaS9tNm5VdXFCMnhhS2l5ajN6MGxFTDVobDN2aGU1dndac2hsaWNMcVJ3WHZET0FuVQp3MnR6SGlFUUd6MTFlUlNBNC9rbHRhYndZbmdBbWN5bWVqUW9FUm82MVpOWXBBVEgzSkkyWmxleW1uRDl3VkVmCmx5cXNtNmVCNkF5ZThmaUZIbmxVdlpZTm1rRFljSDVhNkJEMGhBekpkQVVicjI4OW50OVFsZzBDZ1lFQTQ4RnMKSkJubkJ4dlNSUDRaN3Vrd1RPWWZ0UHhEZlFTWXN3ekZmYnR3RTZheksrUzNwd1h1QVVjRFpXZ0xvRytYbTJHRAp2WDlvQTRWVk11ekpuZ0tkbFU0UndkSlRBSHFRamRPbHFOQTVnbTk3Wm5MMmJrbW52RE9PU3J4L0hRT0VoU1hwCkY3L1Q0WTV5OTlkWVBRQXBuYmRjU2JVck1tNkRRSlV2WHpPZ2J2TUNnWUVBMFh6eXpsYXZqOUUxWDR3RnBUWGQKN3dhanUzQU10clpXWW10L0hkbVZ0dUE1NkEzOFpmR1BsaDBXM2pzNTdrUFVjb3VzeE04YWRFQXhhVWc5RXFGZAp3cndnbjdUVy9TYWNsU3Z3T0ZJOWNjWUxsbml3bzA3NDkzTDdYcE1nNmFmYmszOXBIaTRWbWlCVlFMME9ybUlGCnpsT25DN21wclV3dmE0N1hPeGxBQS8wQ2dZQUEzbW9GTVR3YVlOYktnSldrdmFyN2dCMDYyWU9BWkpZWWlNSHcKR3Rqd21rQXd1S3lpckhrZDlDRmxMNkpydUVGQnpIdHVLNkEvOHpCQ0EzazVheFVpenF0dXE5aTVOYjU3YkFWRAp3WmVXa2NwTXQ3K002Q2NGcHNTeU1FbmoySEdXK0hBTk1TUWp4aUZXSkxJbmVXcXZPVlhXeWlRaUN4M2hEekNoCkVsZFlWUUtCZ1FEVlhZWlJDL2hidE42WnV3eG5yU1pmTEdia1hUcmhwQXkrV2gzc1ZDdXVrTW1vNlU3bzdYUDIKS0hJN0wzQmgxTWc4MnlkU3JEVW1xTld4RFo5dXkxNC8vOTJHSDBoV20rZ0drVlNCeU5tbmoxMVJmODhFZ29nWQpsL2V2b3ZaejVyeHdDb1pNTHpnT1hUdFNuaElYcVpoaGRDUlJVYXBmUEQvMHYrZkMxdjlvREE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=",
					},
				},
			},
		},
	}

	for _, tt := range validRuntimeSpecs {
		r.T().Run(tt.desc, func(t *testing.T) {
			errs := tt.spec.Validate()
			t.Log(errs)
			r.Nil(errs)
		})
	}

	var singleValidationErrorCases = []struct {
		desc           string
		spec           *RuntimeSpec
		expectedErrMsg string
	}{
		{
			desc: "registry_settings_cannot_contain_empty_strings",
			spec: &RuntimeSpec{
				Registries: []*RegistryConfig{
					{
						Name:         "",
						Capabilities: []string{},
						SkipVerify:   false,
						Server:       "",
						CACert:       "",
						ClientCert:   "",
						ClientKey:    "",
					},
				},
			},
			expectedErrMsg: "spec.runtime.registries.name cannot be empty",
		},
		{
			desc: "registry_settings_must_have_base64_encoded_cert_values",
			spec: &RuntimeSpec{
				Registries: []*RegistryConfig{
					{
						Name:         "registry1:443",
						Capabilities: []string{},
						SkipVerify:   false,
						Server:       "https://registry1",
						CACert:       "aaaaaaaaaaaaaaaaaaa",
						ClientCert:   "bbbbbbbbbbbbbbbbbbb",
						ClientKey:    "ccccccccccccccccccc",
					},
				},
			},
			expectedErrMsg: "spec.runtime.registries.ca cannot be empty",
		},
	}

	for _, tt := range singleValidationErrorCases {
		r.T().Run(tt.desc, func(t *testing.T) {
			errs := tt.spec.Validate()
			r.Contains(errs[0].Error(), tt.expectedErrMsg)
		})
	}

}

func TestRuntimeSuite(t *testing.T) {
	runtimeSuite := &runtimeSuite{}

	suite.Run(t, runtimeSuite)
}
